import{r as s,g as I,c as L,o as z,j as e,R as F,m as D,s as B,A as R,a as O,b as A,d as M,e as V,f as T,u as _,h as q,i as W,k as G}from"./index-D_SaP_S6.js";import{FaEnvelope as H,FaLock as J,FaEdit as K,FaTrash as Q,FaExternalLinkAlt as X,FaFileUpload as Y}from"https://esm.sh/react-icons@5.2.1/fa";const Z=F.memo(({onLogin:c,auth:d})=>{const[g,m]=s.useState(""),[p,a]=s.useState(""),[f,r]=s.useState(""),[h,o]=s.useState(!1),u=async t=>{t.preventDefault(),o(!0),r("");try{await O(d,g,p),c(!0)}catch{r("Invalid credentials. Please try again.")}finally{o(!1)}};return e.jsx("div",{className:"max-w-md mx-auto mt-10",children:e.jsxs(D.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"p-8 rounded-2xl bg-white shadow-2xl border border-slate-200/50",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-700",children:"Admin Access"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Log in to manage your portfolio."})]}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"email",placeholder:"Email",value:g,onChange:t=>m(t.target.value),className:"input-field pl-12",required:!0,disabled:h})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"password",placeholder:"Password",value:p,onChange:t=>a(t.target.value),className:"input-field pl-12",required:!0,disabled:h})]}),e.jsx("button",{type:"submit",className:"btn-primary w-full !py-3 !text-base",disabled:h,children:h?"Logging in...":"Login"})]}),f&&e.jsx("p",{className:"text-center mt-4 text-red-500 bg-red-100 p-3 rounded-lg",children:f})]})})}),ee=F.memo(({db:c,storage:d,fetchProjects:g,existingProject:m,onDone:p})=>{const[a,f]=s.useState({title:m?.title||"",description:m?.description||"",skills:m?.skills?.join(", ")||"",imageUrl:m?.imageUrl||"",imagePath:m?.imagePath||""}),[r,h]=s.useState(null),[o,u]=s.useState(0),[t,j]=s.useState(""),[y,v]=s.useState(!1),i=!!m?.id,w=N=>{const{name:l,value:x}=N.target;f(n=>({...n,[l]:x}))},C=N=>{N.target.files[0]&&h(N.target.files[0])},$=async N=>{N.preventDefault(),v(!0),j(""),u(0);let l=a.imageUrl,x=a.imagePath;try{if(r){if(i&&a.imagePath){const U=A(d,a.imagePath);try{await M(U)}catch(P){console.warn("Could not delete old image, it may not exist:",P)}}const b=`projects/${Date.now()}_${r.name}`,E=A(d,b),S=_(E,r);await new Promise((U,P)=>{S.on("state_changed",k=>u(k.bytesTransferred/k.totalBytes*100),k=>P(k),async()=>{l=await q(S.snapshot.ref),x=b,U()})})}const n={...a,skills:a.skills.split(",").map(b=>b.trim()).filter(b=>b),imageUrl:l,imagePath:x};i?await W(T(c,"projects",m.id),n):await G(L(c,"projects"),n),j(`Project ${i?"updated":"added"} successfully!`),g(),setTimeout(()=>p(),1500)}catch(n){console.error("Error saving project:",n),j(`Error: ${n.message}`)}finally{v(!1)}};return e.jsxs("div",{className:"p-8 rounded-2xl bg-white shadow-xl",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-700 mb-6",children:i?"Edit Project":"Add New Project"}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsx("input",{type:"text",name:"title",placeholder:"Project Title",value:a.title,onChange:w,className:"input-field",required:!0}),e.jsx("textarea",{name:"description",placeholder:"Project Description",value:a.description,onChange:w,className:"input-field h-32",required:!0}),e.jsx("input",{type:"text",name:"skills",placeholder:"Skills (comma-separated, e.g., React, Firebase)",value:a.skills,onChange:w,className:"input-field"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Project Photo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),a.imageUrl&&!r&&e.jsx("img",{src:a.imageUrl,alt:"Current",className:"w-24 h-24 object-cover mt-2 rounded-md"})]}),o>0&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${o}%`}})}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:y,children:y?"Saving...":i?"Update Project":"Add Project"}),e.jsx("button",{type:"button",onClick:p,className:"btn-secondary flex-1",disabled:y,children:"Cancel"})]}),t&&e.jsx("p",{className:"text-center mt-4 text-blue-600",children:t})]})]})}),te=F.memo(({db:c,storage:d,fetchAllData:g,initialData:m,onDone:p})=>{const[a,f]=s.useState({licenses:"link",internships:"link"}),[r,h]=s.useState({licenses:null,internships:null}),[o,u]=s.useState({licensesPdfUrl:m.licensesPdfUrl||"",internshipsPdfUrl:m.internshipsPdfUrl||""}),[t,j]=s.useState({licenses:0,internships:0}),[y,v]=s.useState(""),[i,w]=s.useState(!1),C=(l,x)=>new Promise((n,b)=>{if(!x){n(o[`${l}PdfUrl`]);return}const E=`certifications/${l}_${Date.now()}_${x.name}`,S=A(d,E),U=_(S,x);U.on("state_changed",P=>j(k=>({...k,[l]:P.bytesTransferred/P.totalBytes*100})),P=>b(P),()=>q(U.snapshot.ref).then(n))}),$=async l=>{l.preventDefault(),w(!0),v("Processing updates...");try{const[x,n]=await Promise.all([a.licenses==="upload"?C("licenses",r.licenses):Promise.resolve(o.licensesPdfUrl),a.internships==="upload"?C("internships",r.internships):Promise.resolve(o.internshipsPdfUrl)]);await setDoc(T(c,"portfolioAssets","main"),{licensesPdfUrl:x,internshipsPdfUrl:n},{merge:!0}),v("Assets updated successfully!"),g(),setTimeout(()=>p(),1500)}catch(x){v(`Error: ${x.message}`)}finally{w(!1)}},N=(l,x)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:x}),e.jsxs("div",{className:"flex gap-4 mb-3",children:[e.jsxs("button",{type:"button",onClick:()=>f(n=>({...n,[l]:"link"})),className:`btn-tab ${a[l]==="link"?"active":""}`,children:[e.jsx(X,{})," Link"]}),e.jsxs("button",{type:"button",onClick:()=>f(n=>({...n,[l]:"upload"})),className:`btn-tab ${a[l]==="upload"?"active":""}`,children:[e.jsx(Y,{})," Upload"]})]}),a[l]==="link"?e.jsx("input",{type:"url",name:`${l}PdfUrl`,placeholder:"External PDF Link",value:o[`${l}PdfUrl`],onChange:n=>u(b=>({...b,[n.target.name]:n.target.value})),className:"input-field"}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"application/pdf",onChange:n=>h(b=>({...b,[l]:n.target.files[0]})),className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),t[l]>0&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${t[l]}%`}})})]}),o[`${l}PdfUrl`]&&e.jsx("a",{href:o[`${l}PdfUrl`],target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline mt-1 block",children:"View Current PDF"})]});return e.jsxs("div",{className:"p-8 rounded-2xl bg-white shadow-xl",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-700 mb-6",children:"Manage Certification PDFs"}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[N("licenses","Certifications PDF"),N("internships","Internships PDF"),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:i,children:i?"Updating...":"Update Assets"}),e.jsx("button",{type:"button",onClick:p,className:"btn-secondary flex-1",disabled:i,children:"Cancel"})]}),y&&e.jsx("p",{className:"text-center mt-4 text-blue-600",children:y})]})]})}),se=F.memo(({db:c,storage:d,auth:g,projects:m,fetchAllData:p,licensesPdfUrl:a,internshipsPdfUrl:f})=>{const[r,h]=s.useState("projects"),[o,u]=s.useState(null),[t,j]=s.useState(null),y=s.useCallback(async()=>{try{await B(g)}catch(i){console.error("Logout error:",i)}},[g]),v=async()=>{if(t)try{if(t.type==="project"&&t.data.imagePath){const i=A(d,t.data.imagePath);await M(i)}await V(T(c,t.collection,t.data.id)),p()}catch(i){console.error("Delete error:",i)}finally{j(null)}};return o?.type==="project"?e.jsx(ee,{db:c,storage:d,fetchProjects:p,existingProject:o.data,onDone:()=>u(null)}):o?.type==="asset"?e.jsx(te,{db:c,storage:d,fetchAllData:p,initialData:{licensesPdfUrl:a,internshipsPdfUrl:f},onDone:()=>u(null)}):e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-700",children:"Dashboard"}),e.jsx("button",{onClick:y,className:"btn-secondary",children:"Logout"})]}),e.jsxs("div",{className:"flex justify-center border-b border-gray-200 mb-8",children:[e.jsx("button",{onClick:()=>h("projects"),className:`tab-button ${r==="projects"?"active":""}`,children:"Manage Projects"}),e.jsx("button",{onClick:()=>h("assets"),className:`tab-button ${r==="assets"?"active":""}`,children:"Manage Assets"})]}),e.jsx(R,{mode:"wait",children:e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:[r==="projects"&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>u({type:"project",data:null}),className:"btn-primary mb-4",children:"Add New Project"}),e.jsx("div",{className:"space-y-3 max-h-[50vh] overflow-y-auto pr-2",children:m?.map(i=>e.jsxs("div",{className:"flex justify-between items-center bg-slate-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:i.imageUrl,alt:i.title,className:"w-12 h-12 object-cover rounded-md"}),e.jsx("span",{className:"font-semibold",children:i.title})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>u({type:"project",data:i}),className:"text-blue-500 hover:text-blue-700",children:e.jsx(K,{size:20})}),e.jsx("button",{onClick:()=>j({type:"project",collection:"projects",data:i}),className:"text-red-500 hover:text-red-700",children:e.jsx(Q,{size:20})})]})]},i.id))})]}),r==="assets"&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-600 mb-4",children:"Update the links or upload new PDF files for your certifications and internships."}),e.jsx("button",{onClick:()=>u({type:"asset"}),className:"btn-primary w-full max-w-xs mx-auto",children:"Update Asset PDFs"})]})]},r)}),e.jsx(R,{children:t&&e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 z-50 flex justify-center items-center",children:e.jsxs(D.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},className:"bg-white p-8 rounded-2xl shadow-xl max-w-sm w-full text-center",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Confirm Deletion"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:['Are you sure you want to delete "',t.data.title,'"? This cannot be undone.']}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:v,className:"bg-red-500 text-white px-6 py-2 rounded-md font-semibold hover:bg-red-600",children:"Delete"}),e.jsx("button",{onClick:()=>j(null),className:"bg-gray-200 text-gray-700 px-6 py-2 rounded-md font-semibold hover:bg-gray-300",children:"Cancel"})]})]})})})]})}),ie=({db:c,auth:d,storage:g})=>{const[m,p]=s.useState(!1),[a,f]=s.useState(!0),[r,h]=s.useState({projects:[],licensesPdfUrl:"",internshipsPdfUrl:""}),o=s.useCallback(async()=>{if(c)try{const t=(await I(L(c,"projects"))).docs.map(v=>({id:v.id,...v.data()})),y=(await I(L(c,"portfolioAssets"))).docs[0]?.data()||{};h({projects:t,licensesPdfUrl:y.licensesPdfUrl||"",internshipsPdfUrl:y.internshipsPdfUrl||""})}catch(u){console.error("Error fetching portfolio data:",u)}},[c]);return s.useEffect(()=>{if(!d){f(!1);return}return z(d,t=>{p(!!t),t&&o(),f(!1)})},[d,o]),a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading..."}):e.jsx("div",{className:"bg-slate-50 min-h-screen py-12 px-4",children:e.jsx("div",{className:"container mx-auto",children:m?e.jsx(se,{db:c,storage:g,auth:d,projects:r.projects,licensesPdfUrl:r.licensesPdfUrl,internshipsPdfUrl:r.internshipsPdfUrl,fetchAllData:o}):e.jsx(Z,{onLogin:p,auth:d})})})};export{ie as default};
